<!DOCTYPE html>
<html lang="en">
<head >
<link href="https://fonts.googleapis.com/css?family=Nunito:200,400,800" rel="stylesheet">
<meta charset="UTF-8">
    <meta name="viewport" content="width=100%, initial-scale=1.0, height=100vh">
    <title>2048 Game</title>
<style type="text/css">
    body {
  background-color: #FFF8AF;
  overflow: hidden;
  paddin: 0;
  margin: 0;
}
    .controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  position: absolute;
  top: 80vh;
  left: 50%;
  transform: translateX(-50%);
}

button.move {
  font-size: 30px;
  padding: 20px 30px;
  cursor: pointer;
  border-radius: 5px;
  border: none;
  background-color: #F7CA7A;
  color: white;
  transition: background-color 0.3s;
  box-shadow: 0px 0px 7px rgba(0,0,0,0.5);
  outline: none;
}

button.move:hover {
  background-color: #E4B86E;
}


/* head */
.head {
  height: 120px;
  width: 510px;
  margin-left: auto;
  margin-right: auto;
  display: block;
  float: center;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #F7CA7A;
  box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
}

div.game {
  box-shadow: 0px 0px 3px rgba(0,0,0,0.5);
}

.head {
  height: 120px;
  width: 510px;
  margin-left: auto;
  margin-right: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: 20px; /* Зміщення вниз */
  background-color: #F7CA7A;
  box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
}

.info, .repeat {
  margin-top: 10px; /* Відступ між кнопками */
}

#gameOver {
  font-family: Nunito, sans-serif;
  font-size: 30px;
  color: white;
  background-color: #7D3C34;
  padding: 20px;
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.5s, visibility 0.5s;
  z-index: 1001;
}

#gameOver.show {
  visibility: visible;
  opacity: 1;
}

div.description {
  height: 250px;
  width: 300px;
  top: 1000px;
  color: #333;
  font-family: nunito;
  transform: translate(-50%, -50%) scale(0);
  position: absolute;
  left: 50%;
  top: 425px;
  background: #fff;
  padding: 50px;
  border-radius: 0px;
  z-index: 1000;
  box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
  text-align: center;
  visibility: hidden;
  opacity: 0;
  font-size: 15px;
  transition: 0.3s all;
}

.description.show {
  visibility: visible;
  opacity: 1;
  font-size: 15px;
  transform: translate(-50%, -50%) sc/le(1);
  transition: 0.3s all;
}

.info {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-weight: 100;
  cursor: pointer;
  border: 0px;
  border-color: #aaa;
  background-color: #F0BB60;
  color: #fff;
  font-size: 20px;
  top: 1vh;
  transform: translate(-50%, -50%);
  margin-left: 25px;
  transition: 0.1s background-color;
  box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
  position: relative;
}

.info:hover {
  background-color: #E4B86E;
}


.repeat {
  margin: 0px !important;
}

.a {
  font-family: Nunito;
  font-size: 7vh;
  font-weight: 200;
  margin-right: 2vh;
  color: white;
  background-color: FFD489;
  
}

.score {
  position: relative;
  width:15px;
  height: 100px;
  top: 40px;
  font-family: nunito;
  font-weight: 400;
  font-size: 20px;
  color: grey;
  text-align: center;
  margin-right: 10vh;
  color: white;
}



/* field */
.field, .grid {
  position: absolute;
  width: 50vh;
  height: 40vh;
  background-color: #888;
  top: 150px;
  border-radius: 0px;
  border:5px solid #888;
  display: table;
  margin-left: auto;
  margin-right: auto;
  left: 0;
  right: 0;
}

.field {
  z-index: 50;
  box-shadow: 0px 0px 7px rgba(0,0,0,0.5);
}

.grid {
  z-index: 100;
}

.row, .grid_row {
  width: 40vh;
  height: 13vh;
  position: relative;
  display: table-row;
}

.cell, .grid_cell {
  background-color: white;
  width: 5vh;
  height: 5vh;
  position: relative;
  display: table-cell;
  border-radius: 0px;
  border: 4px solid #888;
  text-align: center;
  vertical-align: middle;
  font-family: nunito;
  font-size: 50px;
}

.grid_cell {
  background-color: #aaa;
  color: white;
  
}

div > div > div > div {
  opacity: 0;
  position: absolute;
}

.tile {
  opacity: 1;
  width: 11.8vh;
  height: 12.1vh;
  background-color: white;
  z-index: 150;
  border-radius: 0px;
  font-weight: 200;
  top: 0;
  left: -1px;
  color: black;
  transition: 0.3s all;
  display: -webkit-box;
  display: -webkit-flex;
  display: -moz-box;
  display: -moz-flex;
  display: -ms-flexbox;
  display: flex;

  -webkit-box-pack: center;
  -ms-flex-pack: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  justify-content: center;

  -webkit-box-align: center;
  -ms-flex-align: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  align-items: center;
}

#status {
  width: 100%;
  height: 100vh;
}

.won {
  background-color: #337538;
  transition: 0.3s all;
  
}

.lose {
  background-color: #FFF8AF;
}
</style>
</head>

<body>
  <div class="game">
    <div class="head">
      <div class="a"><b>2048</b> <button class="info" onClick='info()'>i</button> <button id="repeat" class="info repeat" onClick='reset()'>↻</button></div>
      <div class="score"><b>Score:</b><br/><span id="value"></span></div>
    </div>
    <div class="description" id="description">
    How to play:<br/><br/>
    Use your arrow-keys to slide the tiles. <br/>
    Two tiles with the same value in line can be merged. The goal is to merge the tiles and get the 2048 tile.<br/><br/>
    The score is a sum of the merged tiles.<br><br/>
    <span>_______________________________</span><br/><br/>
    Made by Fabian Richter 01/2017
  </div>
    <div class="field">
      
      <div class="row">
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
      </div>
      <div class="row">
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
      </div>
      <div class="row">
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
      </div>
      <div class="row">
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
      </div>
    </div>
    
  </div>
  <div class='' id='status'>
  </div>
  <div class="controls">
  <button class="move" id="up" onClick="moveUp()">↑</button>
  <button class="move" id="left" onClick="moveLeft()">←</button>
  <button class="move" id="right" onClick="moveRight()">→</button>
  <button class="move" id="down" onClick="moveDown()">↓</button>
 </div>
  <script type="text/javascript">
      window.onload = function() {
  buildGridOverlay();                      //Generates grid-overlay
  cellCreator(2, 0);
  directions();
  score(0);
};


/* GENERATE GRID */
function buildGridOverlay() {
  var game    = document.getElementsByClassName('game');  
  var grid    = document.getElementsByClassName('grid');
  var size    = 4;
  var table   = document.createElement('DIV');

  table.className += 'grid';
  table.id = ' ';
  table.dataset.value = 0;
  
  for (var i = 0; i < size; i++) {
    var tr = document.createElement('DIV');
    table.appendChild(tr);
    tr.id = 'row_' + (i+1);
    tr.className += 'grid_row';
    
    for (var j = 0; j < size; j++) {
      var td = document.createElement('DIV');
      td.id = '' +(i+1) +(j+1);                            //ID with x y
      td.className += 'grid_cell';
      tr.appendChild(td);
    }
  document.body.appendChild(table);
  }
  
  return table;
}



/* RANDOM TILE CREATOR */
function cellCreator(c, timeOut) {
  /* do 2 times for 2 new tiles */
  for (var i = 0; i < c; i++) {
    
    var count = 0;
    /* search for an empty cell to create a tile */
    
    for (var value = 1; value < 2; value++) {
      var randomX = Math.floor((Math.random()*4)+1);
      var randomY = Math.floor((Math.random()*4)+1);
      var checker = document.getElementById('' +randomX +randomY);
      if (checker.innerHTML != '') {
        value = 0;
      } 
    }
    
    var randomValue = Math.floor((Math.random()*4) +1); //create value 1, 2, 3 or 4
    if (randomValue == 3) {randomValue=4};              //3 --> 4
    if (randomValue == 1) {randomValue=2};              //1 --> 2
    var position = document.getElementById(''+randomX +randomY);
    var tile = document.createElement('DIV');           //create div at x, y
    position.appendChild(tile);                         //tile becomes child of grid cell
    tile.innerHTML = ''+randomValue;                    //tile gets value 2 or 4
    
    colorSet(randomValue, tile);
    tile.data = ''+randomValue;
    tile.id = 'tile_'+randomX +randomY;
    position.className += ' active';
    var tileValue = tile.dataset.value;
    tile.dataset.value = ''+randomValue;
    
    console.info(''+timeOut);
    if (timeOut == 0) {
      tile.className = 'tile '+randomValue;
    } else { setTimeout(function() {
        tile.className = 'tile '+randomValue;
      }, 10); }
    
  }
  
  

}

function moveUp() {
  var count = 2;  
  for (var x = 2; x > 1; x--) {
    for (var y = 1; y < 5; y++) {
      moveTilesMain(x, y, -1, 0, 1, 0);
    }
    if (x == 2) {
      x += count;
      count++;
    }
    if (count > 4) { break; }
  }
  cellReset();
}

function moveDown() {
  var count = -2;  
  var test  = 1;
  for (var x = 3; x < 4; x++) {
    for (var y = 1; y < 5; y++) {
      moveTilesMain(x, y, 1, 0, 4, 0);
    }
    if (x == 3) {
      x += count;
      count--;
    }
    if (count < -4) { break; }
  }
  cellReset();
}

function moveLeft() {
  var count = 2;  
  for (var x = 2; x > 1; x--) {
    for (var y = 1; y < 5; y++) {
      moveTilesMain(y, x, 0, -1, 0, 1);
    }
    if (x == 2) {
      x += count;
      count++;
    }
    if (count > 4) { break; }
  }
  cellReset();
}

function moveRight() {
  var count = -2;  
  var noCell = 0;
  var c = 1;
  var d = 0;
  for (var x = 3; x < 4; x++) {
    for (var y = 1; y < 5; y++) {
      moveTilesMain(y, x, 0, 1, 0, 4, c, d);
    }
    if (x == 3) {
      x += count;
      count--;
    }
    if (count < -4) { break; }
  }
  cellReset();
}

//--------------------------------------------------------

function moveTilesMain(x, y, X, Y, xBorder, yBorder, c, d) {      
   
  var tile     = document.getElementById('tile_'+x +y);
  var checker  = document.getElementById(''+x +y);
  var xAround  = x+X;
  var yAround  = y+Y;
  
  if (xAround > 0 && xAround < 5 && yAround > 0 && yAround < 5 && checker.className == 'grid_cell active') {
    var around = document.getElementById(''+xAround +yAround);
    
    //________
      
    if (around.className == 'grid_cell active') {
      //catching
      var aroundTile = document.getElementById('tile_'+xAround +yAround);
      if (aroundTile.innerHTML == tile.innerHTML) {
        //same
        var value = tile.dataset.value*2;
        aroundTile.dataset.value = ''+value;
        aroundTile.className = 'tile '+value;
        aroundTile.innerHTML = ''+value;
        colorSet(value, aroundTile);
        checker.removeChild(tile);
        checker.className = 'grid_cell';
        around.className  = 'grid_cell active merged';
        document.getElementsByClassName('grid').id = 'moved';
        document.getElementsByClassName('grid').className = 'grid '+value;
        var grid = document.getElementById(' ');
        var scoreValue = parseInt(grid.dataset.value);
        var newScore = value + scoreValue;
        
        grid.dataset.value = newScore;
        var score = document.getElementById('value');
        
        score.innerHTML = ''+newScore;
      } 
    } else if (around.className == 'grid_cell'){
      //not catching
      around.appendChild(tile);
      around.className = 'grid_cell active';
      tile.id = 'tile_'+xAround +yAround;
      checker.className = 'grid_cell';
      document.getElementsByClassName('grid').id = 'moved';
    }
    
    
    //________
  }  
}


//-------------------------------------------------------


function cellReset() {
  var count = 0;
  var a = document.getElementsByClassName('grid').id;
  console.log(''+a);
  
  for (var x=1; x<5; x++) {
    for (var y=1; y<5; y++) {
      
      var resetter = document.getElementById(''+x +y);
      if (resetter.innerHTML != '') {
        count++;
      }
      
      if (resetter.innerHTML == '') {
        resetter.className = 'grid_cell';
      } 
      
      if (resetter.className == 'grid_cell active merged') {
        resetter.className = 'grid_cell active'
      }
    }
  }
  if (count == 16) {
    document.getElementById('status').className = 'lose';
  } else if (document.getElementsByClassName('grid').id == 'moved'){ 
    cellCreator(1, 1); 
  }
  document.getElementsByClassName('grid').id = ' ';
}

function score() {
  
  var grid = document.getElementById(' ');
  var value = grid.dataset.value;
  document.getElementById('value').innerHTML = ''+value;
  
}


/* ----- STYLE ----- */
function colorSet(value, tile) {
  switch(value) {
    case 2:    tile.style.background = '#fbfced'; tile.style.color = 'black'; break;
    case 4:    tile.style.background = '#ecefc6'; tile.style.color = 'black'; break;
    case 8:    tile.style.background = '#ffb296'; tile.style.color = 'black'; break;
    case 16:   tile.style.background = '#ff7373'; tile.style.color = 'black'; break;
    case 32:   tile.style.background = '#f6546a'; tile.style.color = 'white'; break;
    case 64:   tile.style.background = '#8b0000'; tile.style.color = 'white'; break;
    case 128:  tile.style.background = '#794044'; tile.style.color = 'white'; 
               tile.style.fontSize = '50px'; break;
    case 256:  tile.style.background = '#31698a'; tile.style.color = 'white';
               tile.style.fontSize = '50px'; break;
    case 512:  tile.style.background = '#297A76'; tile.style.color = 'white';
               tile.style.fontSize = '50px'; break;
    case 1024: tile.style.background = '#2D8A68'; tile.style.color = 'white';
               tile.style.fontSize = '40px'; break;
    case 2048: tile.style.background = '#1C9F4E'; tile.style.color = 'white'; 
               tile.style.fontSize = '40px'; 
               document.getElementById('status').className = 'won'; break;
    case 4096: tile.style.background = '#468499'; tile.style.color = 'white'; 
               tile.style.fontSize = '40px'; break;
    case 8192: tile.style.background = '#0E2F44'; tile.style.color = 'white';
               tile.style.fontSize = '40px'; break;
  }
                    
}

function info() {
  setTimeout(function() {
    document.getElementById('description').classList.toggle('show');
  }, 10);  
  
}

function reset() {
  for (var x = 1; x < 5; x++) {
    for (var y = 1; y < 5; y++) {
      var resetter = document.getElementById(''+x +y);
      if (resetter.className == 'grid_cell active') {
        var tile = document.getElementById('tile_'+x +y);
        resetter.removeChild(tile);
      }
    }
  }
  document.getElementById('status').className = '';
  document.getElementById(' ').dataset.value = 0;
  score();
  cellReset();
  cellCreator(2, 0);
}
function gameOver() {
  // Відображаємо повідомлення про програш з анімацією
  var gameOverMessage = document.getElementById('gameOver');
  gameOverMessage.classList.add('show');
}

// Функція для перевірки програшу
function checkGameOver() {
  var count = 0;
  for (var x = 1; x < 5; x++) {
    for (var y = 1; y < 5; y++) {
      var cell = document.getElementById('' + x + y);
      if (cell.innerHTML != '') {
        count++;
      }
    }
  }
  // Якщо всі клітинки заповнені і неможливо зробити рух, то програш
  if (count === 16) {
    gameOver();
  }
}

// Оновлений cellReset для перевірки програшу після кожного ходу
function cellReset() {
  var count = 0;
  for (var x = 1; x < 5; x++) {
    for (var y = 1; y < 5; y++) {
      var resetter = document.getElementById('' + x + y);
      if (resetter.innerHTML != '') {
        count++;
      }
      if (resetter.innerHTML == '') {
        resetter.className = 'grid_cell';
      }
      if (resetter.className == 'grid_cell active merged') {
        resetter.className = 'grid_cell active';
      }
    }
  }
  if (count == 16) {
    document.getElementById('status').className = 'lose';
    gameOver(); // Викликаємо гру про програш
  } else if (document.getElementsByClassName('grid').id == 'moved') {
    cellCreator(1, 1);
  }
  document.getElementsByClassName('grid').id = ' ';
}

// Додамо новий блок для Game Over в HTML
document.body.innerHTML += `
  <div id="gameOver">Game Over! Try Again!</div>
`;
document.getElementById('repeat').addEventListener('click', function() {
  // Сховати плашку "Game Over"
  var gameOverMessage = document.getElementById('gameOver');
  gameOverMessage.style.visibility = 'hidden'; // Приховуємо плашку
});
  </script>
</body>